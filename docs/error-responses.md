# Error responses

The following document describes how error responses should be structured in JSON and what HTTP status codes should be used.

## JSON body

Error responses should always include a JSON body that conforms to [RFC7807](https://datatracker.ietf.org/doc/html/rfc7807), also known as a "problem detail".

publiq APIs should always include at least the 4 following properties defined by the standard:

- `type` - A URL used to identify the problem. It is encouraged that this URL points to a human-readable explanation of the error for developers
- `title` - A short, human-readable summary of the problem type. (Should always be the same for the given `type`!)
- `detail` - A human-readable summary about this specific instance of the problem. Does not always have to be the same for the given type.
- `status` - The HTTP status code generated by the origin server for this occurrence of the problem

For example:

```json
{
  "type": "https://api.publiq.be/probs/uitpas/invalid-uitpasnumber",
  "title": "UiTPAS number invalid",
  "detail": "UiTPAS numbers should be exactly 13 digits.",
  "status": "400"
}
```

> Note that since `type` is URI, it should use lowercase characters and hyphens (`kebab-case`) for casing.

Additionally the standard allows for extra properties. Endpoints on publiq APIs that return an error response based on invalid data in a JSON body of a request should include an extra `jsonPointer` property that contains a [RFC6901](https://datatracker.ietf.org/doc/html/rfc6901) pointer to the problematic JSON property.

For example given the JSON body:

```json
{
  "uitpasNumbers": [
    "0900000905506",
    "129876542345678987633456434567", // invalid
    "0000100038306",
  ]
}
```

The error response can pinpoint the problematic property value like this:

```json
{
  "type": "https://api.publiq.be/probs/uitpas/invalid-uitpasnumber",
  "title": "UiTPAS number invalid",
  "detail": "UiTPAS numbers should be exactly 13 digits.",
  "status": "400",
  "jsonPointer": "/uitpasNumbers/1" // Indicates the problematic property value
}
```

## Content-Type

Error responses should always include a `Content-Type` header with a `application/problem+json` value.

## Status codes

Endpoints that return an error response should always use a HTTP status in the 4XX-5XX range.

### 401 Unauthorized vs 403 Forbidden

Use `401 Unauthorized` when a request should contain a bearer token but the token is missing, invalid, or **expired**.

Use `403 Forbidden` when the request was correctly authenticated, but the authenticated user or client does not have sufficient permissions to perform the requested operation.

### 400 Bad request vs 404 Not found

Use `400 Bad request` when an invalid parameter name/value was included in the request, if the JSON included in the request body was invalid, etc.

Use `404 Not found` **only** if the requested endpoint does not exist or an entity specified in the **path** was not found.

For example, given that the event with id `7b9fbdfc-08be-4ddd-9f8f-151eb219e626` does not exist, then the following `GET` should return a `404` because the path does not exist:

```
GET /events/7b9fbdfc-08be-4ddd-9f8f-151eb219e626
```

But the following `GET` should return a `400` because the `/calsum` path does exist, but the given `eventId` is invalid:
```
GET /calsum?eventId=7b9fbdfc-08be-4ddd-9f8f-151eb219e626
```
