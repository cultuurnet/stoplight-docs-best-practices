# Errors

The following document describes how error responses have to be structured in JSON and what HTTP status codes should be used.

## Body

Error responses must always include a JSON body that conforms to [RFC7807](https://datatracker.ietf.org/doc/html/rfc7807), also known as a "problem detail".

### Required properties

Error responses from publiq APIs must always include at least the 3 following properties defined by the standard:

*   `type` - A URL used to identify the problem. It is encouraged that this URL points to a human-readable explanation of the error for developers
*   `title` - A short, human-readable summary of the problem type. (Must always be the same for the given `type`!)
*   `status` - The HTTP status code generated by the origin server for this occurrence of the problem

It is also encouraged to include the following optional properties:

*   `detail` - A human-readable summary about this specific instance of the problem. Does not always have to be the same for the given type.

For example:

```json
{
  "type": "https://api.publiq.be/probs/uitpas/invalid-uitpasnumber",
  "title": "UiTPAS number invalid",
  "status": "400",
  "detail": "UiTPAS numbers must be exactly 13 digits."
}
```

The `type` should always start with `https://api.publiq.be/probs`. If the error is specific to your API, it should then be followed by the slug of your API (same as in its scope), for example `/uitpas`. Everything after that can be structured as you want for your API.

> Note that since `type` is a URI, it has to use lowercase characters and hyphens (`kebab-case`) for casing.

<!-- theme: success -->

> #### Existing types 
>
> We have lists with [types for common errors](https://publiq.stoplight.io/docs/errors). These can be used as a fallback when you do not have a more specific type in your own API for a given error.
>
> Additionally we have some types for [authentication errors](https://publiq.stoplight.io/docs/authentication/docs/errors.md), which you are **required** to use when returning a 401 or 403.

### Extensions

The RFC7807 standard allows for [extra, custom properties](https://datatracker.ietf.org/doc/html/rfc7807#section-3.2) (*"extensions"*). Below is a list of commonly used extra properties on publiq APIs.

#### jsonPointer

Endpoints on publiq APIs that return an error response based on invalid data in a JSON body of a request should include an extra `jsonPointer` property that contains a [RFC6901](https://datatracker.ietf.org/doc/html/rfc6901) pointer to the problematic JSON property.

For example given the JSON body:

```json
{
  "uitpasNumbers": [
    "0900000905506",
    "129876542345678987633456434567", // invalid
    "0000100038306",
  ]
}
```

The error response can pinpoint the problematic property value like this:

```json
{
  "type": "https://api.publiq.be/probs/uitpas/invalid-uitpasnumber",
  "title": "UiTPAS number invalid",
  "detail": "UiTPAS numbers must be exactly 13 digits.",
  "status": "400",
  "jsonPointer": "/uitpasNumbers/1" // Indicates the problematic property value
}
```

## Content-Type

Error responses must always include a `Content-Type` header with a `application/problem+json` value.

## Status

Endpoints that return an error response must always use a HTTP status in the 4XX-5XX range.

### 401 Unauthorized

Use `401 Unauthorized` when a request has to contain a bearer token but the **token is missing, invalid, or expired**.

Or alternatively, if the endpoint uses client identification, if **the client id is missing or invalid**.

If the token or client id is valid but is missing the required scope to access this particular API, use 403.

<!-- theme: warning -->

> 401 responses **must** use the `https://api.publiq.be/probs/auth/unauthorized` problem detail type.

### 403 Forbidden

Use `403 Forbidden` when the request was correctly authenticated, but the authenticated user or client does not have sufficient permissions to perform the requested operation or to access the API.

<!-- theme: warning -->

> 403 responses **must** use the `https://api.publiq.be/probs/auth/forbidden` problem detail type.

### 400 Bad request

Use `400 Bad request` when an invalid parameter name/value was included in the request, if the JSON included in the request body was invalid, etc.

Also use it for "not found" errors related to, for example, ids passed as query parameters or inside JSON bodies.

For example:

    GET /calsum?eventId=7b9fbdfc-08be-4ddd-9f8f-151eb219e626

If the `eventId` does not exist, this endpoint must return a 400 because it exists. Only the  parameter happens to be invalid.

### 404 Not found

Use `404 Not found` if the requested endpoint does not exist, or an id specified in the **path** was not found.

For example:

    GET /events/7b9fbdfc-08be-4ddd-9f8f-151eb219e626

If the event id does not exist, this endpoint must return a 404 because the requested resource does not exist.
